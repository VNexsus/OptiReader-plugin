<!--
 (c) Copyright VNexus 2024

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 -->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>OptiReader</title>
	<script type="text/javascript" src="resources/js/plugins.js"></script>
    <script type="text/javascript" src="resources/js/plugins-ui.js"></script>
	<script type="text/javascript" src="vendor/jquery/jquery-3.7.1.min.js"></script>
	<script type="text/javascript" src="scripts/code.js"></script>
	<script type="module" src="vendor/pdf.js/pdf.mjs"></script>
	<script type='text/javascript' src='vendor/tesseract/tesseract.min.js'></script>
	<script type="text/javascript" src="vendor/cropperjs/cropper.js"></script>	
	<link rel="stylesheet" href="vendor/cropperjs/cropper.css">
    <link rel="stylesheet" href="resources/css/plugins.css">
    <link rel="stylesheet" href="resources/css/app.css">
	<style>
		html, body {
			min-height: 100% !important;
			height: 100%;
			overflow-y:hidden;
            overflow-x: hidden;
			padding: 0!important;
			background-color: var(--background-normal)!important;
		}
		
		.btn {
			padding: 1px 10px;
			user-select: none;
		}
		
		#pageframe {
			display: flex;
			flex-direction: column;
			height: 100%;
		}
		
		#toolbar {
			display: flex;
			flex-direction: row;
			flex: 1;
			padding: 10px;
			background-color: var(--background-toolbar);
			border-bottom: 1px solid var(--border-toolbar);
		}
		
		#file-tools,
		#pdf-tools,
		#ocr-tools,
		#ocr-status {
			flex-basis: 50%;
			text-align: center;
			display: flex;
			animation: intro .3s both;
		}
		
		#file-tools > div,
		.page-tools,
		.page-tools > div {
			display: inline-block;
			padding: 0 5px;
		}

		#page-counter {
			display: inline-block;
			padding: 0;
		}
		
		#ocr-tools > div {
			display: inline-block;
			padding: 0 5px;
		}
		
		#workarea {
			display: flex;
			flex-direction: row;
			flex: 100;
			overflow: auto;
			margin: 5px;
		}
		
		#preview-container,
		#ocr-container {
			flex-basis: 50%;
			display: block;
			margin: 0 5px 5px 5px;
			overflow: auto;
			padding: 5px 10px 5px 5px;
		}

		#preview-container {
			text-align: center;
			position: relative;
		}
		
		
		.preview-wrapper {
			box-shadow: 1px 1px 5px 3px rgb(127 127 127 / 30%);
		}
		
		#pdf-preview {
			width: 100%!important;
			height: auto!important;
		}
		
		#pdf-preview {
			animation: intro .3s both;
			border: none!important;
			display: none;
		}
		
		#upload-container {
			position: absolute;
			top: 0;
			left: 0;
			display: table;
			vertical-align: middle;
			text-align: center;
			width: 100%;
			height: 100%;
			z-index: 100;
			background: var(--background-normal);
			padding: 15px 20px;
			cursor: pointer;
		}
		.upload {
			color: var(--text-link);
			font-size: 200%;
			display: table-cell;
			vertical-align: middle;
			background: var(--backgroud-normal);
			margin: 10%;
			border: 1px dashed var(--border-regular-control);
			border-radius: 10px;
			padding: 40px;
		}
		
		.upload-icon {
			background-image: url(./resources/img/folder.svg);
			width: 110px;
			height: 110px;
			display: block;
			border: none;
			background-repeat: no-repeat;
			background-position: center;
			margin: 0 auto 30px auto;
		}
		
		#progress {
			width: 100px;
			display: inline-block;
		}
		.progress{
			text-align: center;
			position: relative;
			border: 1px solid var(--border-preview-hover);
			border-radius: 3px;
		}
		.progressvalue{
			position: relative;
			display: inline-block;
			z-index: 1;
			margin-top: 1px;
		}
		.progressbar-container {
			position: absolute;
			width: 100%;
			left: 0;
			top: 0;
			height: 100%;
			padding: 1px;	
		}
		.progressbar{
			left: 0;
			top: 0;
			height: 100%;
			width: 0;
			max-width: 100%;
			background: rgba(43, 226, 133, .7);
			border-radius: 2px;
			transition: all .3s;
		}
		
		.text-stub {
			display: table;
			width: 100%;
			height: 100%;
			border: 1px dashed var(--border-divider);
			border-radius: 5px;
			animation: intro .3s both;
		}
		
		.text-stub > div {
			display: table-cell;
			height: 100%;
			text-align: center;
			vertical-align: middle;
			font-size: 200%;
			color: var(--border-regular-control);
			padding: 15px;
		}
		
		#text-preview {
			height: 100%;
			position: relative;
		}
		
		#text-preview > div {
			animation: intro .3s both;
		}
		
		#text-preview .page-break {
			height: 1px;
			background: var(--border-regular-control);
			margin: 20px 0;
			color: var(--border-regular-control);
		}
		
		#text-preview .page-break:after {
			content: 'следующая страница';
			position: relative;
			top: -8px;
			text-align: center;
			background: var(--background-normal);
			margin: 0 0 0 5px;
			padding: 0 5px 0 5px;
		}
		
		#text-preview p {
			white-space: nowrap;
			font-size: 11pt;
		}
		
		#text-preview span.word {
			position: relative;
			border-radius: 3px;
			-moz-user-select: text;
		}
		
		#text-preview span.active {
			background: rgba(255,255,0,0.3)!important;
		}
		
		#text-preview span.options {
			position: absolute;
			width: 20px;
			height: 20px;
			background: url(./resources/img/check.svg);
			user-select: none;
			cursor: pointer;
			background-position: center;
			background-repeat: no-repeat;
			background-size: contain;
			border-radius: 5px;
			background-color: rgba(255,255,255,0.8);
			box-shadow: 1px 1px 4px 0px var(--background-scrim);
			animation: intro .3s both;
		}
		
		#text-preview span.wc-0,
		#text-preview span.wc-10,
		#text-preview span.wc-20,
		#text-preview span.wc-30,
		#text-preview span.wc-40,
		#text-preview span.wc-50 {
			outline: 1px solid rgba(255,0,0,0.50);
		}
		
		.btn.active {
			background: var(--highlight-button-pressed);
			border-color: var(--border-control-focus);
		}
		
		.btn.icon {
			border-radius: 2px;
		}
		
		.btn.icon > svg		{
			width: 16px;
			height: 16px;
			display: inline-block;
			border: none;
			margin: 1px;
			fill: var(--text-secondary);
		}
		.btn.icon > span {
			display: inline-block;
			line-height: 18px;
			padding-left: 5px;
		}
		.btn.select > svg,
		.btn.paste > svg,
		.btn.single > svg,
		.btn.multiple > svg	{
			margin-left: -5px;
		}

		.btn.select,
		.btn.paste,
		.btn.single,
		.btn.multiple {
			display: flex;
		}
		
		.highlighter {
			display: none;
			position: absolute;
			width: 0;
			height: 0;
			background: rgba(255,255,0,0.3);
			scroll-behavior: smooth;
		}

		#processing {
			width: 120px;
			height: 120px;
			display:inline-block;
			stroke: var(--border-regular-control);
		}
		#process-indicator {
			animation: rotation 3000ms linear infinite normal forwards;
			stroke: var(--border-control-focus);
		}
		
		@keyframes rotation { 
			0% {
				transform: translate(150.088601px,145.272991px) rotate(0deg)
			} 
			100% {
				transform: translate(150.088601px,145.272991px) rotate(360deg)
			}
		}

		
		@keyframes intro {
			0% {
				opacity: 0;
			}
			100% {
				opacity: 1;
			}
		}
		
	</style>
</head>
<body style="width: 100%;height: 100%; padding: 5px;">
	<div id="pageframe">
		<div id="toolbar">
			<div id="file-tools">
				<div>
					<input style="display: none" type="file" id="uploadfile" multiple accept=".pdf,.png,.jpg,.jpeg,.gif"/>
					<button id="selectfile" class="form-control btn icon select">
						<svg width="800px" height="800px" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
							<g stroke-width="1" fill-rule="evenodd">
								<g transform="translate(-360.000000, -151.000000)">
									<path d="M390,161 L362,161 L362,155 C362,153.896 362.896,153 364,153 L370,153 C371.104,153 372,153.896 372,155 L372,157 L388,157 C389.104,157 390,157.896 390,159 L390,161 L390,161 Z M390,179 C390,180.104 389.104,181 388,181 L364,181 C362.896,181 362,180.104 362,179 L362,163 L390,163 L390,179 L390,179 Z M388,155 L374,155 C374,152.791 372.209,151 370,151 L364,151 C361.791,151 360,152.791 360,155 L360,179 C360,181.209 361.791,183 364,183 L388,183 C390.209,183 392,181.209 392,179 L392,159 C392,156.791 390.209,155 388,155 L388,155 Z"></path>
								</g>
							</g>
						</svg>
						<span>Выбрать файл...</span>
					</button>
				</div>
				<div class="page-tools">
					<div>
						<button id="crop" disabled class="form-control btn icon crop">
							<svg width="800px" height="800px" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
								<g stroke-width="1" fill-rule="evenodd">
									<g transform="translate(-310.000000, -881.000000)">
										<path d="M340,905 L338,905 L338,890 L334,894 L334,905 L320,905 L339.213,884.201 L337.799,882.787 L318,904 L318,889 L328,889 L331.861,885 L318,885 L318,883 C318,881.896 317.104,881 316,881 C314.896,881 314,881.896 314,883 L314,885 L312,885 C310.896,885 310,885.896 310,887 C310,888.104 310.896,889 312,889 L314,889 L314,909 L334,909 L334,911 C334,912.104 334.896,913 336,913 C337.104,913 338,912.104 338,911 L338,909 L340,909 C341.104,909 342,908.104 342,907 C342,905.896 341.104,905 340,905"/>
									</g>
								</g>
							</svg>
						</button>
					</div>
				</div>
				<div class="page-tools">
					<div><button id="prev" disabled class="form-control btn">&#x1F860;</button></div>
					<div id="page-counter">
						Лист <span id="page_num"></span> / <span id="page_count"></span>
					</div>
					<div><button id="next" disabled class="form-control btn">&#x1F862;</button></div>
				</div>
			</div>
			<div id="ocr-tools">
				<div>
					<button id="recognize" disabled class="form-control btn icon single" title="Распознать этот лист">
						<svg width="800px" height="800px" viewBox="-3 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
							<g stroke-width="1" fill-rule="evenodd">
								<g transform="translate(-103.000000, -99.000000)">
									<path d="M122,115 L110,115 C109.448,115 109,115.448 109,116 C109,116.553 109.448,117 110,117 L122,117 C122.552,117 123,116.553 123,116 C123,115.448 122.552,115 122,115 L122,115 Z M122,121 L110,121 C109.448,121 109,121.447 109,122 C109,122.553 109.448,123 110,123 L122,123 C122.552,123 123,122.553 123,122 C123,121.447 122.552,121 122,121 L122,121 Z M123,107 C121.896,107 121,106.104 121,105 L121,101 L127,107 L123,107 L123,107 Z M127,127 C127,128.104 126.104,129 125,129 L107,129 C105.896,129 105,128.104 105,127 L105,103 C105,101.896 105.896,101 107,101 L118.972,101 C118.954,103.395 119,105 119,105 C119,107.209 120.791,109 123,109 L127,109 L127,127 L127,127 Z M121,99 L121,99.028 C120.872,99.028 120.338,98.979 119,99 L107,99 C104.791,99 103,100.791 103,103 L103,127 C103,129.209 104.791,131 107,131 L125,131 C127.209,131 129,129.209 129,127 L129,107 L121,99 L121,99 Z"/>
								</g>
							</g>
						</svg>
						<span>Распознать лист</span></button>
				</div>
				<div>
					<button id="recognizeall" disabled class="form-control btn icon multiple" title="Распознать весь документ">
						<svg width="800px" height="800px" viewBox="-2 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
							<g stroke-width="1" fill-rule="evenodd">
								<g transform="translate(-206.000000, -99.000000)">
									<path d="M229,107 C227.935,107 227,105.065 227,104.026 L227,101.031 L227,101.029 L232,107 L229,107 L229,107 Z M232,123 C232,124.019 231.05,125 230,125 L215,125 C213.95,125 213,124.019 213,123 L213,103 C213,101.981 213.95,101 215,101 L225,101 C224.984,103.304 225,105.025 225,105.025 C225,107.103 226.87,109 229,109 L232,109 L232,123 L232,123 Z M225,129 L210,129 C208.95,129 208,128.019 208,127 L208,107 C208,105.981 208.855,105.032 209.905,105.032 L211,105 L211,123 C211,125.059 212.884,127 215,127 L227,127 C227,128.019 226.049,129 225,129 L225,129 Z M227,99 L215,99 C212.884,99 211,100.941 211,103 L209.845,103.027 C207.729,103.027 206,104.941 206,107 L206,127 C206,129.059 207.884,131 210,131 L225,131 C227.116,131 229,129.059 229,127 L230,127 C232.116,127 234,125.059 234,123 L234,107.023 L227,99 L227,99 Z M227,113.018 L218,113.018 C217.448,113.018 217,113.465 217,114.017 C217,114.568 217.448,115.016 218,115.016 L227,115.016 C227.552,115.016 228,114.568 228,114.017 C228,113.465 227.552,113.018 227,113.018 L227,113.018 Z M227,118.013 L218,118.013 C217.448,118.013 217,118.46 217,119.012 C217,119.563 217.448,120.011 218,120.011 L227,120.011 C227.552,120.011 228,119.563 228,119.012 C228,118.46 227.552,118.013 227,118.013 L227,118.013 Z"/>
								</g>
							</g>
						</svg>
						<span>Распознать все</span>
					</button>
				</div>
				<div>
					<button id="addtext" disabled class="form-control btn icon paste" title="Добавить текст в документ">
						<svg width="800px" height="800px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
							<path d="M3.5 6.75L3.5028 4.62704C2.62745 4.93512 2 5.76929 2 6.75V17.2542C2 19.8776 4.12665 22.0042 6.75 22.0042H11.8136C11.3866 21.5601 11.0222 21.0554 10.7345 20.5043L6.75 20.5042C4.95507 20.5042 3.5 19.0491 3.5 17.2542V6.75Z"/>
							<path d="M18 11.1739V4.25C18 3.00736 16.9926 2 15.75 2H6.75C5.50736 2 4.5 3.00736 4.5 4.25V17.25C4.5 18.4926 5.50736 19.5 6.75 19.5H10.3135C10.159 19.0218 10.0585 18.5195 10.0189 18H6.75C6.33579 18 6 17.6642 6 17.25V4.25C6 3.83579 6.33579 3.5 6.75 3.5H15.75C16.1642 3.5 16.5 3.83579 16.5 4.25V11C17.0163 11 17.5185 11.0602 18 11.1739Z"/>
							<path d="M16.5 12C19.5376 12 22 14.4624 22 17.5C22 20.5376 19.5376 23 16.5 23C13.4624 23 11 20.5376 11 17.5C11 14.4624 13.4624 12 16.5 12ZM17.0011 20.5035L17.0006 18H19.4966C19.7725 18 19.9961 17.7762 19.9961 17.5C19.9961 17.2239 19.7725 17 19.4966 17H17.0005L17 14.4993C17 14.2231 16.7761 13.9993 16.5 13.9993C16.2239 13.9993 16 14.2231 16 14.4993L16.0005 17H13.4956C13.2197 17 12.9961 17.2239 12.9961 17.5C12.9961 17.7762 13.2197 18 13.4956 18H16.0006L16.0011 20.5035C16.0011 20.7797 16.225 21.0035 16.5011 21.0035C16.7773 21.0035 17.0011 20.7797 17.0011 20.5035Z"/>
						</svg>
						<span>Добавить в документ</span>
					</button>
				</div>
			</div>
			<div id="ocr-status" style="display: none">
				<label class="header" style="margin-right:10px">
					Распознавание <span id="ocr_num"></span> из <span id="ocr_count"></span>
				</label>
				<div id="progress" class="progress">
					<span class="progressvalue"></span>
					<div class="progressbar-container"><div class="progressbar"></div></div>
				</div>				
			</div>
		</div>
		<div id="workarea">
			<div id="preview-container">
				<div class="preview-wrapper">
					<canvas id="pdf-preview" style="border: 1px solid black; direction: ltr;"></canvas>
				</div>
			</div>
			<div id="ocr-container">
				<div id="text-preview">
					<div class="text-stub">
						<div>Здесь появится текст после распознавания</div>
					</div>
				</div>
			</div>
			<div id="upload-container">
				<div class="upload">
					<div><span class="upload-icon"/></div>
					Выберите документ Adobe Acrobat или набор изображений PNG, JPG, GIF для распознавания
				<div>
			<div>
		</div>
	</div>
</body>
</html>